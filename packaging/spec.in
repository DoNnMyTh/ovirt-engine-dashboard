Name: ovirt-engine-dashboard
Summary: oVirt Engine Dashboard
Version: @RPM_VERSION@
Release: 2@RPM_SNAPSHOT@%{?dist}
License: ASL 2.0
URL: http://www.ovirt.org/
Source: @TAR_FILE@

BuildArch: noarch

BuildRequires: ovirt-engine-nodejs
BuildRequires: ovirt-engine-nodejs-modules >= 0.0.7

Requires: ovirt-engine-webadmin-portal

%description
oVirt UI plugin that gives overview of the virtualized environment and its specific objects.

%prep

# Unpack the source:
%setup -q -n %{name}-%{version}

# Set up Node.js environment with npm dependencies linked to ./node_modules:
source %{_datadir}/ovirt-engine-nodejs-modules/setup-env.sh

# Build the application:
npm run build

%install

# Install the files:
mkdir -p %{buildroot}%{_datadir}/%{name}
cp -r dist/* %{buildroot}%{_datadir}/%{name}

# Ensure that Engine ui-plugins directory exists:
mkdir -p %{buildroot}%{_datadir}/ovirt-engine/ui-plugins

# Link application's resources to Engine ui-plugins directory:
ln -s "%{_datadir}/%{name}/dashboard.json" "%{buildroot}%{_datadir}/ovirt-engine/ui-plugins"
ln -s "%{_datadir}/%{name}/dashboard-resources" "%{buildroot}%{_datadir}/ovirt-engine/ui-plugins"

%files
%{_datadir}/%{name}
%{_datadir}/ovirt-engine/ui-plugins/dashboard.json
%{_datadir}/ovirt-engine/ui-plugins/dashboard-resources
%doc README.adoc
%license LICENSE

%changelog
* Fri May 20 2016 Vojtech Szocs <vszocs@redhat.com> - 0.0.1-2
- Use setup-env.sh script provided by ovirt-engine-nodejs-modules.

* Thu May 19 2016 Vojtech Szocs <vszocs@redhat.com> - 0.0.1-1
- Define RPM release tag with optional snapshot information.

* Wed May 18 2016 Vojtech Szocs <vszocs@redhat.com> - 0.0.1
- Require ovirt-engine-webadmin-portal instead of ovirt-engine.

* Fri May 6 2016 Vojtech Szocs <vszocs@redhat.com> - 0.0.1
- Update spec file to link UI plugin resources to oVirt Engine.

* Thu Apr 21 2016 Vojtech Szocs <vszocs@redhat.com> - 0.0.1
- Initial packaging.
